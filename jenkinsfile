pipeline {

agent any

environment {

    IMAGE_NAME='ssk1811/pollimage'

    IMAGE_TAG='latest'

}
stages {

stage('Checkout') {

steps {


checkout scm


}

}



stage('Build') {

steps {



sh 'dotnet build'

}

}

stage('Docker Build'){
steps{
script{
docker.build("${IMAGE_NAME}:${IMAGE_TAG}")
}
}
}

stage('Docker Push'){

    steps{

        script{

            docker.withRegistry('https://index.docker.io/v1/','docker_login'){


                docker.image("${IMAGE_NAME}:${IMAGE_TAG}").push()

            }
        }

    }

}
stage('Run container') {

steps {

script{
sh 'docker stop PollTrial '
 sh'docker rm PollTrial'
    sh "docker run -d --name PollTrial -p 1020:80 ${IMAGE_NAME}:${IMAGE_TAG}"
}

}

}
}

}
